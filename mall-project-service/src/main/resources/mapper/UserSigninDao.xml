<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mall.dao.UserSigninDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.mall.entity.UserSigninEntity" id="userSigninMap">
        <result property="userSigninId" column="user_signin_id"/>
        <result property="userId" column="user_id"/>
        <result property="createTime" column="create_time"/>
        <result property="point" column="point"/>
    </resultMap>
	
	<select id="queryUserSigninList" resultType="com.mall.model.UserSignin">
		SELECT 
			user_signin_id,
			user_id,
			date_format(create_time,'%Y-%m-%d') create_time,
			point
		FROM tb_user_signin 
		<where>
			<if test="userSignin != null and userSignin.userId != null">
				AND user_id=#{userSignin.userId} 
			</if> 
			<if test="userSignin != null and userSignin.createTime != null">
				AND date_format(create_time,'%Y-%m-%d') = #{userSignin.createTime}
			</if>
		</where> 
		ORDER BY create_time DESC
	</select>
	
	<select id="queryUserSigninCount" resultType="int">
		SELECT 
			count(1)
		FROM tb_user_signin 
		<where>
			<if test="userSignin != null and userSignin.userId != null">
				AND user_id=#{userSignin.userId} 
			</if> 
			<if test="userSignin != null and userSignin.createTime != null">
				AND date_format(create_time,'%Y-%m-%d') = #{userSignin.createTime}
			</if>
		</where> 
	</select>
	
	<select id="queryAllUserSigninPoint" resultType="int">
		SELECT 
			SUM(point)
		FROM tb_user_signin 
		<where>
			<if test="userSignin != null and userSignin.userId != null">
				AND user_id=#{userSignin.userId} 
			</if> 
		</where> 
	</select>
	
	<select id="queryUsersigninByCTime" resultType="com.mall.model.UserSignin">
		SELECT 
			user_signin_id,
			user_id,
			date_format(create_time,'%Y-%m-%d') create_time,
			point
		FROM tb_user_signin 
		WHERE user_id=#{userId} 
		AND date_format(create_time,'%Y-%m-%d') = date_format(NOW(),'%Y-%m-%d');
	</select>
	
	
	<insert id="insertUserSignin" useGeneratedKeys="true" 
		keyProperty="userSinginId" keyColumn="user_signin_id">
		INSERT INTO tb_user_signin (
			user_id,
			create_time,
			point
		) VALUES (
			#{userId},
			NOW(),
			#{point}
		);
	</insert>

</mapper>